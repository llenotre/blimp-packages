#!/bin/bash

set -e

# Creating configuration
# TODO Adapt arch to TARGET
cat >.config <<EOF
GENERAL_ARCH="x86"
GENERAL_SCHEDULER_END_PANIC="true"
DEBUG_DEBUG="false"
DEBUG_TEST="false"
DEBUG_TESTPROCESS="false"
DEBUG_STORAGETEST="false"
DEBUG_QEMU="false"
DEBUG_MALLOC_MAGIC="false"
DEBUG_MALLOC_CHECK="false"
DEBUG_RUST_BACKTRACE="false"
EOF

make maestro

mkdir -p $SYSROOT/usr/src/maestro
cp -rv ./* $SYSROOT/usr/src/maestro/
# TODO find a way to avoid copying .git, since it can get pretty big
cp -rv ./.* $SYSROOT/usr/src/maestro/
rm -r $SYSROOT/usr/src/maestro/.git/
