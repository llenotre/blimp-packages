#!/bin/bash

set -e



# Compiling
cargo build --release --target $TARGET -Zbuild-std
strip target/$TARGET/release/solfege



# Installing
mkdir -p $SYSROOT/sbin
mkdir -p $SYSROOT/etc/solfege/services

cat >$SYSROOT/etc/fstab <<EOF
# <file system> <dir> <type> <options> <dump> <pass>
tmpfs			/tmp	tmpfs	rw		0		0
sysfs			/sys	sysfs	rw		0		1
procfs			/proc	procfs	rw		0		2
EOF
ln -sv /proc/self/mounts $SYSROOT/etc/mtab

echo '/sbin/login' >$SYSROOT/etc/solfege/startup

cp target/$TARGET/release/solfege $SYSROOT/sbin/init
